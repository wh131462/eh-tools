# EH-Tools 功能需求文档

> 本文档仅包含功能点和具体实现需求，用于复刻开发参考。

---

## 一、全局功能

### 1.1 首页导航

- 顶部轮播横幅，自动播放发布信息图片
- 工具列表按 4 大分类展示：时间工具、生活工具、计算工具、艺术工具
- 每个工具以"图标 + 名称"网格形式展示
- 点击工具项跳转到对应页面
- 支持分享给好友和分享到朋友圈

### 1.2 个人中心

- 显示用户头像和昵称
- 未登录时显示"登录"入口，已登录时显示昵称
- 点击头像进入个人信息编辑页
- 菜单入口：设置、关于
- 底部显示版权信息，年份范围从 2025 至当前年份动态计算

### 1.3 个人信息编辑

- **选择头像**：调用系统头像选择器（微信 `chooseAvatar`），选择后实时预览
- **修改昵称**：输入框，使用微信昵称输入类型
- **登录**：验证昵称不为空后保存用户信息，标记为已登录，自动返回上页
- **修改确认**：仅在已登录且有修改时显示按钮，点击保存修改
- **退出登录**：弹出确认对话框，确认后清除用户信息，返回上页
- 用户信息持久化存储到本地（`user_info` key）

### 1.4 设置

- **语言切换**：点击弹出 Picker 选择器，可选中文/英文，切换后立即生效
- **深色模式**：开关控件，切换后更新导航栏和 TabBar 主题色
- 语言和主题状态均持久化到本地存储

### 1.5 关于

- 展示应用信息列表：应用名称（EH Tools）、版本号（1.0.7）、应用描述、开发者（EternalHeart）
- **项目地址**：点击复制 GitHub 链接到剪贴板
- **提交反馈**：点击复制 Issues 链接到剪贴板
- **赞赏支持**：点击弹出底部弹窗，显示微信赞赏二维码图片，图片可点击放大预览

### 1.6 多语言

- 支持中文和英文两种语言，共 672 项翻译
- 所有用户可见文本、页面标题、TabBar 文字均跟随语言切换实时更新
- 页面显示时和语言变化时自动更新导航栏标题

### 1.7 深色模式

- 支持系统偏好自动检测 + 手动切换
- 切换时同步更新：导航栏文字颜色和背景色、TabBar 背景色和文字颜色、页面整体配色

---

## 二、时间工具

### 2.1 万年历

**功能描述**：日历视图选择日期，查看完整的农历和黄历信息。

**具体需求**：

- 展示标准月历网格，可翻页浏览不同月份
- 每个日期格子下方显示农历日期或节假日名称（优先显示节假日）
- 有日程的日期以红点标记
- 点击任意日期后，下方展示完整农历详情面板：
  - 农历日期（如"农历癸卯年正月廿三"）
  - 干支纪年、生肖
  - **宜/忌**事项列表
  - 建除十二神
  - 节气信息
  - 二十八宿
  - 胎神占方
  - 彭祖百忌
  - 三候、六曜、九星
  - 吉神宜趋 / 凶神宜忌列表
  - 时辰吉凶表（子丑寅卯...十二时辰，标注吉/凶）
  - 公历节假日、农历节假日（如有）
- 农历转换使用 tyme4ts 库

### 2.2 倒计时器

**功能描述**：设定一个时长后开始倒计时，归零时弹窗提醒。

**具体需求**：

- 中央大字显示当前剩余时间，格式 `HH:MM:SS`（两位补零）
- 点击时间显示区弹出时间选择器（时/分/秒），选中后计算总秒数：`时*3600 + 分*60 + 秒`
- **6 个预设快捷按钮**：1 分钟(60s)、3 分钟(180s)、5 分钟(300s)、10 分钟(600s)、15 分钟(900s)、30 分钟(1800s)
- **开始按钮**：启动 setInterval 每秒递减 1，按钮文字变为"暂停"
- **暂停按钮**：清除定时器，保留当前秒数
- **重置按钮**：清除定时器，秒数归零
- 倒计时归零时：清除定时器，弹出完成提示对话框，秒数归零
- 页面卸载时自动清除定时器防止内存泄漏

### 2.3 时间差计算

**功能描述**：选择两个时间点，计算精确时间差。

**具体需求**：

- 两个时间输入框：开始时间、结束时间，默认均为当前时间
- 点击输入框弹出 DatePicker（年/月/日/时/分）
- 自动计算并展示 7 个维度的差值：
  - 年、月（年后的剩余月数）
  - 周、天（周后的剩余天数）
  - 小时（天后的剩余小时）、分钟（小时后的剩余分钟）、秒（分钟后的剩余秒）
- 计算逻辑：先算毫秒差，逐级转换取余
- **4 个快速选项按钮**：
  - "一周前"：开始=now-7天，结束=now
  - "一月前"：开始=now-1月，结束=now
  - "一年前"：开始=now-1年，结束=now
  - "下周"：开始=now，结束=now+7天
- 任何时间变化时自动重新计算差值

### 2.4 世界时钟

**功能描述**：同时显示多个城市/时区的当前时间，每秒刷新。

**具体需求**：

- 顶部固定显示上海时间（时间 + 日期），每秒实时刷新
- 下方列表显示已选择的时区，每项显示：城市名称、IANA时区名、当前时间、当前日期
- **时区转换算法**：UTC时间 = 本地时间 + 本地偏移；目标时间 = UTC + 目标偏移小时 * 3600000ms
- 预定义 10 个常用时区：上海(+8)、纽约(-4)、伦敦(+1)、东京(+9)、悉尼(+10)、巴黎(+2)、洛杉矶(-7)、迪拜(+4)、新加坡(+8)、莫斯科(+3)
- 右下角浮动 "+" 按钮，点击弹出时区选择器列表
- 选择时区后添加到列表（自动去重），保存到本地存储
- 点击已有时区项可将其删除
- 初始加载时从本地存储恢复已选时区，默认只有上海
- 使用 setInterval 每秒更新 currentTime，页面卸载时清除

---

## 三、计算工具

### 3.1 科学计算器

**功能描述**：支持基础和科学两种模式的计算器。

**具体需求**：

- **显示区域**：上方小字显示完整表达式，下方大字(36px)显示当前输入/结果
- **模式切换按钮**：基础模式 / 科学模式

**基础模式键盘布局**：
```
C    DEL    ÷
7    8    9    ×
4    5    6    -
1    2    3    +
0    .    =
```

**科学模式额外增加**：
```
sin    cos    tan    √
(      )      x²     π
```

**计算规则**：
- 使用 expr-eval 库解析数学表达式
- `×` 替换为 `*`，`÷` 替换为 `/`
- 科学模式：`π` 替换为 Math.PI，`x²` 转换为 `^2`，支持 sin/cos/tan/sqrt 函数
- 小数点：每个数字中只能有一个
- 连续输入运算符：后一个替换前一个
- 结果格式化：保留 8 位小数，去除末尾多余零（`.toFixed(8).replace(/\.?0+$/, '')`）
- 无效表达式：显示错误提示 2 秒后清空

### 3.2 劳动法工资计算器

**功能描述**：根据基本工资和加班情况，计算实际应得工资并检查是否违法。

**具体需求**：

**输入项**：
- 基本工资（月薪，默认 5000）
- 日工作时长（小时，默认 9）
- 周末加班时长（月累计小时，默认 0）
- 法定节假日加班时长（月累计小时，默认 0）

**常量**：
- 标准工作时长 = 8 小时/天
- 月平均工作日 = 21.75 天
- 加班倍率：工作日 1.5 倍、休息日 2.0 倍、法定节假日 3.0 倍

**计算公式**：
```
时薪 = 基本工资 / (8 × 21.75)
正常工资 = 基本工资
工作日加班费 = max(0, 日工作时长 - 8) × 21.75 × 时薪 × 1.5
周末加班费 = 周末加班时长 × 时薪 × 2.0
节假日加班费 = 节假日加班时长 × 时薪 × 3.0
总工资 = 正常工资 + 工作日加班费 + 周末加班费 + 节假日加班费
```

**合法性检查**（任一不满足则标记违法）：
| 规则 | 限制 |
|------|------|
| 日工作时长 | ≤ 12 小时 |
| 日加班时长 | ≤ 3 小时 |
| 月加班总时长 | ≤ 36 小时 |

月加班总时长 = (日工作时长 - 8) × 21.75 + 周末加班时长 + 节假日加班时长

**结果展示**：
- 总工资大字展示（48px，蓝色）
- 进度条（合法绿色/违法红色）
- 4 个 Tag 展示工资构成：正常工资、工作日加班费、周末加班费、节假日加班费
- 违法时显示红色警告区域，列出所有违法情况
- 所有数值保留 2 位小数

### 3.3 BMI 计算器

**功能描述**：输入身高体重，实时计算 BMI 并给出健康建议。

**具体需求**：

**输入项**：身高(cm)、体重(kg)

**计算公式**：`BMI = 体重(kg) / [身高(m)]² = (体重 × 10000) / 身高²`

**分类标准**（中国标准）：

| BMI 范围 | 分类 | 健康建议 |
|---------|------|---------|
| < 18.5 | 体重过轻 | 建议增加营养摄入 |
| 18.5 ~ 23.9 | 正常 | 保持当前状态 |
| 24.0 ~ 27.9 | 超重 | 建议适当运动控制饮食 |
| 28.0 ~ 31.9 | 肥胖 | 建议就医咨询 |
| ≥ 32.0 | 严重肥胖 | 建议尽快就医 |

- BMI 数值保留 1 位小数
- 输入变化时自动计算（useEffect 监听）
- 展示 BMI 参考标准表
- 身高或体重无效时不显示结果

### 3.4 房贷计算器

**功能描述**：支持等额本息和等额本金两种方式，生成完整还款计划表。

**具体需求**：

**输入项**：
- 贷款金额（元）
- 贷款期限（年）
- 年利率（%）
- 还款方式选择：等额本息 / 等额本金

**等额本息公式**：
```
月利率 r = 年利率 / 12 / 100
还款月数 n = 年限 × 12
月还款额 M = 贷款本金 × [r(1+r)^n] / [(1+r)^n - 1]
每月利息 = 剩余本金 × r
每月本金 = M - 每月利息
```

**等额本金公式**：
```
月本金 = 贷款本金 / n（固定）
第m月还款额 = 月本金 + [贷款本金 - (m-1) × 月本金] × r
```

**结果展示**：
- 月还款额、总还款额、总利息
- 还款计划列表（每期：期数、本金、利息、总还款额、剩余本金）
- 默认折叠只显示首月和末月摘要
- 展开后使用虚拟列表（容器高度 400px，单项高度 100px）显示全部期次
- 所有金额保留 2 位小数

### 3.5 单位换算器

**功能描述**：支持长度、面积、体积三类单位的互转。

**具体需求**：

**操作流程**：选择分类 → 输入数值 → 选择源单位 → 选择目标单位 → 实时显示结果

**转换算法**：通过基准单位中间转换
```
结果 = 输入值 × 源单位换算率 / 目标单位换算率
```

**长度单位**（基准：米）：

| 单位 | 换算率 |
|-----|--------|
| 公里(km) | 1000 |
| 米(m) | 1 |
| 分米(dm) | 0.1 |
| 厘米(cm) | 0.01 |
| 毫米(mm) | 0.001 |
| 英里(mile) | 1609.344 |
| 码(yard) | 0.9144 |
| 英尺(foot) | 0.3048 |
| 英寸(inch) | 0.0254 |

**面积单位**（基准：平方米）：

| 单位 | 换算率 |
|-----|--------|
| 平方公里(km²) | 1000000 |
| 平方米(m²) | 1 |
| 平方分米(dm²) | 0.01 |
| 平方厘米(cm²) | 0.0001 |
| 平方毫米(mm²) | 0.000001 |
| 公顷(ha) | 10000 |
| 英亩(acre) | 4046.856 |
| 平方英尺(ft²) | 0.092903 |

**体积单位**（基准：升）：

| 单位 | 换算率 |
|-----|--------|
| 立方米(m³) | 1000 |
| 立方分米(dm³) | 1 |
| 立方厘米(cm³) | 0.001 |
| 立方毫米(mm³) | 0.000001 |
| 升(L) | 1 |
| 毫升(mL) | 0.001 |
| 加仑(gal) | 3.78541 |
| 立方英尺(ft³) | 28.3168 |

- 切换分类时重置源单位为第一个、目标单位为第二个，清空输入和结果
- 结果保留 6 位小数
- 输入变化时实时计算

---

## 四、文本工具

### 4.1 文本加密/解密

**功能描述**：支持 Base64、AES、DES 三种算法的加密和解密。

**具体需求**：

- 顶部双按钮切换模式：加密 / 解密
- 算法选择：Base64、AES、DES
- 选择 AES 或 DES 时显示密钥输入框

**算法配置**：
| 算法 | 密钥要求 | 模式 | 填充 |
|------|---------|------|------|
| Base64 | 无需密钥 | - | - |
| AES | 16 / 24 / 32 字节 | ECB | Pkcs7 |
| DES | 8 字节 | ECB | Pkcs7 |

**处理流程**：
1. 验证输入文本非空
2. 如需密钥，验证密钥长度符合要求
3. 执行加密/解密操作
4. 显示结果，提供复制按钮

**错误处理**：
- 文本为空提示
- 密钥长度不符提示具体要求
- 处理失败显示错误信息
- 处理中按钮显示 loading 状态并禁用

### 4.2 二维码工具

**功能描述**：生成和扫描二维码，支持中文内容。

**具体需求**：

**生成模式**：
1. 文本输入区（3 行 TextArea）
2. 点击生成按钮 → 使用 qrcode-generator 库生成矩阵（UTF-8 编码，错误修正级别 M）
3. 在 Canvas（210×210px）上绘制：白色背景 + 黑色模块，缩放比 = 210 / 矩阵大小
4. **保存到相册**：检查图片保存权限 → Canvas 转临时文件 → 保存到相册
5. **验证功能**：从 Canvas 获取像素数据 → 用 jsQR 库解码 → 对比原始文本
6. 结果显示区 + 复制按钮

**扫描模式**：
1. **摄像头扫描**：调用系统扫码 API（仅二维码类型），返回结果字符串
2. **相册扫描**：从相册选取图片 → 绘制到 Canvas → 获取像素数据 → jsQR 解码
3. 扫描结果显示 + 复制按钮
4. 扫描成功后自动生成对应的二维码用于验证

**错误处理**：文本为空、生成失败、解码失败、权限拒绝、用户取消操作 — 各有对应提示

---

## 五、图片工具

### 5.1 图片压缩

**功能描述**：批量选择图片进行质量压缩，对比压缩前后大小。

**具体需求**：

- 点击上传区选择图片（最多 9 张，仅相册来源）
- 每张图片自动获取原始文件大小
- **质量滑块**：范围 1~100%
- 点击"开始压缩"对所有图片并行调用系统压缩接口
- 每张图片显示：
  - 原图缩略图 + 原始大小
  - 压缩后缩略图 + 压缩后大小
  - 压缩比例：`(1 - 压缩后 / 原始) × 100%`
  - 如果压缩后反而更大，显示"最佳质量"
  - 单张保存按钮 + 删除按钮
- "全部保存"按钮（仅有压缩结果时显示）
- 文件大小格式化：< 1024B 显示 B；< 1MB 显示 KB（2 位小数）；≥ 1MB 显示 MB（2 位小数）
- 保存前检查图片保存权限

### 5.2 图片滤镜

**功能描述**：选择图片后应用预设滤镜或自定义调节参数。

**具体需求**：

- 选择单张图片（仅相册）
- 图片预览区实时显示滤镜效果

**预设滤镜**（6 种，网格展示带缩略图）：
| 名称 | CSS filter 值 |
|------|--------------|
| 原始 | none |
| 复古 | sepia(100%) |
| 黑白 | grayscale(100%) |
| 反色 | invert(100%) |
| 柔光 | opacity(80%) contrast(120%) |
| 艳丽 | saturate(200%) |

**自定义调整**（5 个滑块）：
| 参数 | 范围 | 默认值 | CSS 单位 |
|------|------|--------|---------|
| 亮度 | 0~200 | 100 | % |
| 对比度 | 0~200 | 100 | % |
| 饱和度 | 0~200 | 100 | % |
| 色调 | 0~360 | 0 | deg |
| 模糊 | 0~10 | 0 | px |

自定义 CSS filter 字符串拼接：
```
brightness(X%) contrast(X%) saturate(X%) hue-rotate(Xdeg) blur(Xpx)
```

- 切换到自定义模式时自动清除预设选择
- 导出按钮保存图片到相册（需权限检查）

### 5.3 色卡工具

**功能描述**：全屏展示纯色色卡，支持颜色选择和收藏。

**具体需求**：

- 页面主体为大色块，背景色为当前 HEX 颜色值
- 非全屏时色块上显示 HEX 值文字
- **点击色块**：切换全屏/非全屏模式（全屏时隐藏控制区和收藏夹）
- **颜色选择器**：弹出 ColorPicker 组件（16 个预设颜色 + 自定义 HEX 输入）
- 颜色变化时同步更新导航栏背景色
- **添加到收藏**：当前颜色不重复则添加，持久化到本地存储（`colorCardFavorites` key，JSON 数组）
- **收藏夹列表**：网格展示所有收藏颜色，每块显示 HEX 值
  - 点击收藏颜色 → 切换为该颜色
  - 长按收藏颜色 → 弹出确认对话框 → 删除

### 5.4 颜色转换器

**功能描述**：HEX、RGB、HSL 三种颜色格式互相转换。

**具体需求**：

- 顶部色块预览当前颜色，显示三种格式的文字值
- **HEX 输入**：文本框，输入自动转大写，格式验证 `/^#[0-9A-F]{6}$/i`
- **RGB 输入**：三个独立数字输入框（R/G/B），范围 0~255
- **HSL 显示**：只读，显示 H(0~360°)、S(0~100%)、L(0~100%)
- 每种格式旁有复制按钮

**转换算法**：

HEX → RGB：正则提取两位十六进制，parseInt 转十进制

RGB → HEX：每个通道 toString(16) 补零拼接

RGB → HSL：
1. 正规化 R/G/B 到 0~1
2. 计算 max、min
3. L = (max + min) / 2
4. S = max==min ? 0 : d/(2-max-min) 或 d/(max+min)
5. H 根据最大通道计算，最终映射到 0~360

- 修改 HEX 自动联动 RGB 和 HSL
- 修改 RGB 任一值自动联动 HEX 和 HSL
- 格式错误时显示对应提示 2 秒后消失

---

## 六、生活工具

### 6.1 大转盘 / 抽奖机

**功能描述**：可自定义配置项的转盘/老虎机随机选择工具，带历史记录管理。

#### 6.1.1 转盘主页

- **两种模式切换**：转盘(LuckyWheel) / 老虎机(SlotMachine)，右上角切换按钮
- 当前数据集名称和描述显示
- 无配置时显示"+ 创建"提示
- 点击开始后转盘旋转，停止后弹出对话框显示结果，可复制结果名称
- 结果自动保存到历史记录
- **设置弹出菜单**（右上角齿轮按钮）：
  - 当前数据集名称 + 切换按钮
  - 进入配置编辑
  - 进入配置列表
  - 进入历史记录
- **数据集切换弹窗**：列表显示所有配置，复选框标记当前选中
- 从配置页返回时强制重新渲染转盘组件

#### 6.1.2 配置编辑页

- **配置信息**：名称（必填）、描述（可选）
- **项目编辑表单**：名称（必填）、颜色（ColorPicker 选择）、概率（0~100）
- 项目列表网格展示：背景色 + 名称 + 概率 + 删除按钮
- 点击已有项目填充到表单进行编辑
- 新增项目 ID 使用 `Date.now().toString()` 生成
- **保存验证**：至少 2 个项目
- 保存时自动判断是新增还是更新（按 ID 匹配）

#### 6.1.3 配置列表页

- 顶部"创建新配置"按钮
- 可滚动列表，每项显示：配置名称(项数)、描述、创建时间
- 点击行进入编辑页（携带 ID 参数）
- 删除按钮（阻止冒泡）+ 确认对话框

#### 6.1.4 历史记录页

- 列表显示历史记录，每条显示：选中项名称、配置名称、时间戳
- 时间格式：`yyyy-MM-dd HH:mm:ss`
- 删除按钮 + 确认对话框
- 历史最多保留 100 条
- 无记录时显示空状态提示

#### 预设配置（6 套）

| 名称 | 项数 | 说明 |
|------|------|------|
| 是或否 | 2 | 二项选择 |
| 十二星座 | 12 | 12个星座 |
| 传统八卦 | 8 | 8个卦象 |
| 周易六十四卦 | 64 | 64卦，带颜色编码 |
| 今天吃什么 | 15 | 15种食物选项 |
| 选择什么语言 | 8 | 8种编程语言 |

---

## 七、数据持久化需求

| 数据 | 存储 Key | 格式 |
|------|---------|------|
| 用户信息 | `user_info` | `{avatar, nickname, isLogin}` |
| 语言设置 | `app_language` | `"zh"` / `"en"` |
| 主题模式 | `theme_mode` | `"dark"` / `"light"` |
| 色卡收藏 | `colorCardFavorites` | `["#FF6F00", "#1890FF", ...]` |
| 世界时钟时区 | `selectedTimeZones` | 时区对象数组 |
| 转盘配置 | Redux 持久化 | 配置对象数组 |
| 转盘历史 | Redux 持久化 | 历史记录数组（最多100条） |
| 日程管理 | Redux 持久化 | 日程对象数组 |

---

## 八、通用交互规范

1. **所有页面**均支持分享给好友和分享到朋友圈，分享内容从全局配置获取
2. **所有页面标题**跟随语言设置实时更新
3. **所有用户可见文本**使用翻译函数，支持中英文切换
4. **涉及保存图片的操作**统一先检查权限，无权限引导用户去设置页
5. **复制操作**统一使用剪贴板 API + 成功/失败 Toast 提示
6. **删除操作**统一先弹出确认对话框
7. **表单验证失败**统一使用 Toast 提示错误信息
8. **页面导航**使用 navigateTo 进入子页面，navigateBack 返回上页

---

*文档生成时间: 2026-01-30*
